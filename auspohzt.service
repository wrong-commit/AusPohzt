[Unit]
Description=Fetch secrets and start Docker Compose
After=network.target
Wants=docker.service

[Service]
Type=oneshot
WorkingDirectory=/opt/app
# Populate .env with AWS secrets
ExecStart=/bin/bash fetch-secrets.sh
# Force rebuild of aus-frontend when environment varibles change.
ExecStartPost=/usr/bin/docker compose up --build --force-recreate --no-deps aus-frontend
RemainAfterExit=true
Environment="AWS_REGION=ap-southeast-2"

[Install]
WantedBy=multi-user.target